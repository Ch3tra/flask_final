{% extends 'layout/layout_admin.html' %}

{% block title %} PRODUCT-LIST {% endblock %}

{% block content %}
    <div id="app">

        <div v-if="productContent == 'index'">
            {% include 'admin/product/index.html' %}
        </div>

        <div v-if="productContent == 'addproduct'">
            {% include 'admin/product/add_product.html' %}
        </div>

        <div v-if="productContent == 'detailproduct'">
            {% include 'admin/product/detailproduct.html' %}
        </div>

    </div>

    <script>
        var vue_obj = new Vue({
            el: '#app',
            delimiters: ["[[", ']]'],
            data: {
                //variables
                product_list: [],
                category_list: [],
                detail_list: [],
                currentPage: 1, // Current page number
                itemsPerPage: 6, // Number of items per page
                productContent: 'index', // set to 'index', for first page load
            },
            created() {
                //run first after refreshed
            },
            computed: {
                paginatedItems() {
                    // if page 1, startindex=0, endindex = 0+6, so slice array(0, 6)
                    // if page 2, startindex=6, endindex = 6+6, so slice array(6, 12)
                    // if page 3, startindex=12, endindex = 12+6, so slice array(12, 18)....
                    const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                    const endIndex = startIndex + this.itemsPerPage;
                    return this.product_list.slice(startIndex, endIndex);
                },
                totalItems() {
                    return this.product_list.length;
                },
                totalPages() {
                    return Math.ceil(this.totalItems / this.itemsPerPage);
                },
            },
            methods: {
                getImageSrc(imageName) {
                    // Logic to generate the image source dynamically
                    // You can add additional logic here if needed
                    return `{{ url_for('static', filename='img/product/') }}${imageName.includes('.') ? imageName : imageName + '.jpg'}`;
                },
                scaleImage(event) {
                    event.target.style.transform = 'scale(1.05)';
                    event.target.style.boxShadow = '0 20px 30px rgba(0, 0, 0, 0.2)';
                },
                resetImage(event) {
                    event.target.style.transform = 'scale(1)';
                    event.target.style.boxShadow = '0 10px 15px rgba(0, 0, 0, 0.1)';
                },
                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                    }
                },
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                    }
                },
                goToPage(pageNumber) {
                    if (pageNumber >= 1 && pageNumber <= this.totalPages) {
                        this.currentPage = pageNumber;
                    }
                },
                goTo(page) {
                    if (page == 'addproduct') {
                        this.productContent = 'addproduct';
                    }
                    if (page == 'index') {
                        this.productContent = 'index';
                    }
                },
                resetForm() {
                    // Reset text inputs and text area
                    document.querySelector('input[type="text"]').value = '';
                    document.querySelector('input[type="number"]').value = '';
                    document.querySelector('textarea').value = '';
                    document.querySelector('select').selectedIndex = 0; // Reset select dropdown

                    // Reset file input (image)
                    const fileInput = document.querySelector('input[type="file"]');
                    fileInput.value = ''; // Reset the value of the input
                    if (fileInput.files && fileInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function () {
                            fileInput.value = '';
                        };
                        reader.readAsDataURL(fileInput.files[0]);
                    }
                },
                submitForm() {
                    const name = document.querySelector('input[type="text"]').value;
                    const cost = document.querySelector('input[type="number"]').value;
                    const description = document.querySelector('textarea').value;
                    const category = document.querySelector('select').value;

                    // Get the file input element and its selected file
                    const fileInput = document.querySelector('input[type="file"]');
                    const imageFile = fileInput.files[0];

                    // Create a FormData object to send both form data and the image file
                    const formData = new FormData();
                    formData.append('name', name);
                    formData.append('cost', cost);
                    formData.append('description', description);
                    formData.append('category', category);
                    formData.append('image_upload', imageFile);

                    axios.post('http://127.0.0.1:5000/admin/product_added', formData, {
                        headers: {
                            'Content-Type': 'multipart/form-data'
                        }
                    })
                        .then(response => {
                            console.log('Product added successfully:', response.data);
                            // Update product_list after successful addition
                            this.product_list.push(response.data.newProduct); // Assuming the response includes the new product data

                            // Reload the page to reflect the updated product list
                            window.location.reload();
                        })
                        .catch(error => {
                            console.error('Error adding product:', error);
                        });
                },
                goToDetails(id) {
                    // Filter the product_list to get details of the selected product by id
                    this.detail_list = this.product_list.filter(product => product.id === id);
                    console.log('detail_list:', this.detail_list);
                    // Set the productContent to 'detailproduct' to display the details view
                    this.productContent = 'detailproduct';
                }
            },
            mounted() {
                // Axios API request to fetch data and assign to product_list
                axios.get('http://127.0.0.1:5000/getAllProduct')
                    .then(response => {
                        this.product_list = response.data.products;
                        this.category_list = response.data.categories;
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            }
        })
    </script>
{% endblock %}

