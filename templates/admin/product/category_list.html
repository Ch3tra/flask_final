{% extends 'layout/layout_admin.html' %}

{% block title %} CATEGORY-LIST {% endblock %}

{% block content %}
    <div id="app">
        <!--Bar -->
        <div class="content-header">
            <div class="row">
                <div class="col-6">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div style="display: flex;" class="col-sm-6">
                                <i class="fab far fa-list-alt fa-2x" style="margin-top: 2px; margin-right: 10px;"></i>
                                <h1 class="m-0">CATEGORY LISTS</h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <a href="" style="float: right; margin-right: 25px">
                        <button type="submit"
                                class="text-white btn-primary font-medium rounded-lg text-md px-3.5 py-2 inline-flex items-center mr-2 mb-2">
                            <i class="fas fa-plus-circle" style="margin-right: 7px; margin-top: 2px;"></i>
                            Add New Category
                        </button>
                    </a>
                </div>
            </div>
        </div>

        <!--Table-->
        <div class="content" style="padding-right: 30px">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12 lg-12">
                        <div class="overflow-x-auto">
                            <div class="bg-gray-100 flex items-center justify-center bg-gray-100 font-sans overflow-hidden">
                                <div class="w-full lg:w-6/6">
                                    <table class="min-w-max w-full table-auto">
                                        <thead>
                                        <tr class="bg-gray-200 text-gray-500 uppercase text-sm leading-normal">
                                            <th class="py-3 px-6 text-left">Name</th>
                                            <th class="py-3 px-6 text-center">Description</th>
                                            <th class="py-3 px-6 text-center">Actions</th>
                                        </tr>
                                        </thead>

                                        <tbody v-for="(item, index) in paginatedItems" :key="index">
                                        <tr>
                                            <td class="py-3 px-6 text-left">[[ item.name ]]</td>
                                            <td class="py-3 px-6 text-center">[[ item.desc ]]</td>

                                            <td class="py-3 px-6 text-center">
                                                <div class="flex item-center justify-center">
                                                    <div class="w-5 mr-2.5 transform hover:text-blue-500 hover:scale-110">
                                                        <form method="post" action="/admin/detail_product">
                                                            <input type="hidden" value="{{ page }}" name="page_id">
                                                            <input type="hidden" value="[[ item.productId ]]"
                                                                   name="pid">
                                                            <button type="submit" title="Details">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width=21
                                                                     height=22 fill="none"
                                                                     viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                          stroke-width="2"
                                                                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                          stroke-width="2"
                                                                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                                </svg>
                                                            </button>
                                                        </form>

                                                    </div>
                                                    <div class="w-5 mr-2.5 transform hover:text-blue-500 hover:scale-110">
                                                        <form method="post" action="/admin/edit_product">
                                                            <input type="hidden" value="[[ item.productId ]]"
                                                                   name="pid">
                                                            <input type="hidden" value="{{ page }}" name="page_id">
                                                            <button type="submit" title="Modify">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width=21
                                                                     height=22 fill="none"
                                                                     viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                          stroke-width="2"
                                                                          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                                                </svg>
                                                            </button>
                                                        </form>
                                                    </div>
                                                    <div class="w-5 mr-2.5 transform hover:text-red-500 hover:scale-110">
                                                        <form
                                                                action=""
                                                                method="post"
                                                        >
                                                            <input type="hidden" value="[[ item.productId ]]"
                                                                   name="pid">
                                                            <input type="hidden" value="{{ page }}" name="page_id">
                                                            <input type="hidden" value="[[ item.image ]]"
                                                                   name="image_upload">
                                                            <button type="submit" title="Delete">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width=21
                                                                     height=22 fill="none"
                                                                     viewBox="0 0 26 26"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                          stroke-width="2"
                                                                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                                </svg>
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--Pagination -->
        {% include 'admin/include/pagination.html' %}
    </div>

    <script>
        var vue_obj = new Vue({
            el: '#app',
            delimiters: ["[[", ']]'],
            data: {
                //variables
                category_list: [],
                currentPage: 1, // Current page number
                itemsPerPage: 6, // Number of items per page
            },
            created() {
                //run first after refreshed
            },
            computed: {
                paginatedItems() {
                    // if page 1, startindex=0, endindex = 0+6, so slice array(0, 6)
                    // if page 2, startindex=6, endindex = 6+6, so slice array(6, 12)
                    // if page 3, startindex=12, endindex = 12+6, so slice array(12, 18)....
                    const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                    const endIndex = startIndex + this.itemsPerPage;
                    return this.category_list.slice(startIndex, endIndex);
                },
                totalItems() {
                    return this.category_list.length;
                },
                totalPages() {
                    return Math.ceil(this.totalItems / this.itemsPerPage);
                },
            },
            methods: {
                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                    }
                },
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                    }
                },
                goToPage(pageNumber) {
                    if (pageNumber >= 1 && pageNumber <= this.totalPages) {
                        this.currentPage = pageNumber;
                    }
                },
            },
            mounted() {
                // Axios API request to fetch data and assign to product_list
                axios.get('http://127.0.0.1:5000/getAllCategory')
                    .then(response => {
                        this.category_list = response.data.cate;
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            }
        })
    </script>
{% endblock %}

